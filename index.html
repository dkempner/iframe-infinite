<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iframe CPU Loop Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 2px solid #ccc;
        border-radius: 5px;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #45a049;
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .status {
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      #clickCounter {
        font-weight: bold;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <h1>Iframe Infinite Loop Demo</h1>
    <p>
      The iframe below will attempt to run an infinite while loop. In modern
      browsers, this may cause high CPU usage and potentially crash the iframe
      process independently.
    </p>

    <iframe
      src="infinite-loop.html"
      width="600"
      height="300"
      sandbox="allow-scripts"
    ></iframe>

    <div class="test-section">
      <h3>Browser Responsiveness Test</h3>
      <p>Click these buttons to test if the browser tab is still responsive:</p>

      <button id="testButton" onclick="testResponsiveness()">
        Test Responsiveness
      </button>

      <button id="clickButton" onclick="incrementCounter()">
        Click Counter: <span id="clickCounter">0</span>
      </button>

      <button id="alertButton" onclick="showAlert()">Show Alert</button>

      <button id="colorButton" onclick="changeColor()">
        Change Background Color
      </button>

      <div id="status" class="status" style="display: none"></div>
    </div>

    <div class="test-section">
      <h3>Performance Monitor</h3>
      <p>
        Last interaction time: <span id="lastInteraction">Not started</span>
      </p>
      <p>Page load time: <span id="loadTime"></span></p>
    </div>

    <p>
      You can monitor your browser performance to see the CPU behavior, but be
      cautious as it could make the iframe unresponsive or crash.
    </p>

    <script>
      let clickCount = 0;
      let lastInteractionTime = Date.now();

      // Record page load time
      window.addEventListener("load", function () {
        document.getElementById("loadTime").textContent =
          performance.now().toFixed(2) + "ms";
      });

      function testResponsiveness() {
        const startTime = performance.now();
        const result = Math.sqrt(1000000) * Math.random();
        const endTime = performance.now();
        const duration = endTime - startTime;

        updateStatus(
          `Responsiveness test completed in ${duration.toFixed(
            2
          )}ms. Result: ${result.toFixed(2)}`,
          "success"
        );
        updateLastInteraction();
      }

      function incrementCounter() {
        clickCount++;
        document.getElementById("clickCounter").textContent = clickCount;
        updateStatus(`Counter incremented to ${clickCount}`, "success");
        updateLastInteraction();
      }

      function showAlert() {
        try {
          alert("Browser is still responsive! Click OK to continue.");
          updateStatus("Alert displayed successfully", "success");
        } catch (error) {
          updateStatus("Failed to show alert: " + error.message, "error");
        }
        updateLastInteraction();
      }

      function changeColor() {
        const colors = ["#f0f8ff", "#f0fff0", "#fff0f0", "#fffff0", "#f0f0ff"];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        document.body.style.backgroundColor = randomColor;
        updateStatus(`Background color changed to ${randomColor}`, "success");
        updateLastInteraction();
      }

      function updateStatus(message, type) {
        const statusDiv = document.getElementById("status");
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
        statusDiv.style.display = "block";

        // Hide status after 3 seconds
        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 3000);
      }

      function updateLastInteraction() {
        lastInteractionTime = Date.now();
        document.getElementById("lastInteraction").textContent = new Date(
          lastInteractionTime
        ).toLocaleTimeString();
      }

      // Monitor for potential freezing
      setInterval(() => {
        const now = Date.now();
        const timeSinceLastInteraction = now - lastInteractionTime;

        if (timeSinceLastInteraction > 10000) {
          // 10 seconds
          updateStatus(
            "Warning: No interaction detected for 10+ seconds. Browser may be freezing.",
            "error"
          );
        }
      }, 5000);
    </script>
  </body>
</html>
